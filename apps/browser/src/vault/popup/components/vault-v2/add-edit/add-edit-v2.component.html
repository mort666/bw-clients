<popup-page>
  <popup-header
    slot="header"
    [pageTitle]="headerText"
    [backAction]="handleBackButton"
    showBackButton
  >
    <ng-container slot="end">
      <button *ngIf="previouslyCouldArchive" bitBadge type="button" variant="secondary">
        {{ "archived" | i18n }}
      </button>
      <app-pop-out />
    </ng-container>
  </popup-header>

  <vault-cipher-form
    *ngIf="!loading"
    formId="cipherForm"
    [config]="config"
    (cipherSaved)="onCipherSaved($event)"
    [beforeSubmit]="checkFido2UserVerification"
    [submitBtn]="submitBtn"
  >
    <app-open-attachments
      slot="attachment-button"
      [cipherId]="originalCipherId"
    ></app-open-attachments>
  </vault-cipher-form>

  <popup-footer slot="footer">
    <button bitButton type="submit" form="cipherForm" buttonType="primary" #submitBtn>
      {{ (previouslyCouldArchive ? "unarchiveAndSave" : "save") | i18n }}
    </button>

    <button (click)="handleBackButton()" bitButton type="button" buttonType="secondary">
      {{ "cancel" | i18n }}
    </button>

    <ng-container slot="end">
      <button
        type="button"
        *ngIf="isEditMode && (archiveFlagEnabled$ | async) && isCipherArchived"
        [bitAction]="unarchive"
        bitIconButton="bwi-unarchive"
        [label]="'unarchive' | i18n"
      ></button>
      <button
        type="button"
        *ngIf="isEditMode && (userCanArchive$ | async) && canCipherBeArchived"
        [bitAction]="archive"
        bitIconButton="bwi-archive"
        [label]="'archiveVerb' | i18n"
      ></button>
      <button
        *ngIf="canDeleteCipher$ | async"
        [bitAction]="delete"
        type="button"
        buttonType="danger"
        bitIconButton="bwi-trash"
        [label]="'delete' | i18n"
      ></button>
    </ng-container>
  </popup-footer>
</popup-page>
